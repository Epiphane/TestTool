/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'andy' at '9/21/15 3:45 PM' with Gradle 2.6
 */

plugins {
    id 'java'
    id 'eclipse'
    id 'com.github.johnrengelman.shadow' version '1.2.2'
    id 'idea'
}



jar {
    manifest {
        attributes 'Main-Class': 'com.teampc.web.server.TestToolApp'
    }
}

shadowJar {
    mergeServiceFiles()
}

task stage(dependsOn: shadowJar)

task runServer(type: JavaExec) {
    def listenPort = System.env.PORT?.toInteger() ?: port 
    classpath = files("${buildDir}/libs/server-all.jar")
    jvmArgs = ["-Ddw.server.applicationConnectors[0].port=${listenPort}",
                  "-Ddw.server.adminConnectors[0].port=${listenPort + 1}"]
    args = ['server', "${projectDir}/testTool.yml"]
    main = 'com.teampc.web.server.TestToolApp'
}

task serve(dependsOn: stage) << { runServer.execute() }

repositories {
    mavenCentral()
}

dependencies {
    compile "io.dropwizard:dropwizard-core:${dropwizard_version}"
    compile "io.dropwizard:dropwizard-testing:${dropwizard_version}"
    compile "io.dropwizard:dropwizard-assets:${dropwizard_version}"
    testCompile 'junit:junit:4.12'
}
